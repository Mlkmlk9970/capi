from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, ContextTypes, filters
import random
import os

# ูู ุงูุฏูู ุงูุฑุณููุฉ (ISO code + ุงูุนุงุตูุฉ)
countries = {
    "ุงูุฌุฒุงุฆุฑ": ("ุงูุฌุฒุงุฆุฑ", "DZ"),
    "ุฃูุบุงูุณุชุงู": ("ูุงุจูู", "AF"),
    "ุฃูุจุงููุง": ("ุชูุฑุงูุง", "AL"),
    "ุฃูุฏูุฑุง": ("ุฃูุฏูุฑุง ูุง ูููุง", "AD"),
    "ุฃูุบููุง": ("ููุงูุฏุง", "AO"),
    "ุงูุฃุฑุฌูุชูู": ("ุจูููุณ ุขูุฑุณ", "AR"),
    "ุฃุฑููููุง": ("ูุฑููุงู", "AM"),
    "ุฃุณุชุฑุงููุง": ("ูุงูุจูุฑุง", "AU"),
    "ุงูููุณุง": ("ููููุง", "AT"),
    "ุฃุฐุฑุจูุฌุงู": ("ุจุงูู", "AZ"),
    "ุงูุจุญุฑูู": ("ุงูููุงูุฉ", "BH"),
    "ุจูุบูุงุฏูุด": ("ุฏูุง", "BD"),
    "ุจูุฌููุง": ("ุจุฑููุณู", "BE"),
    "ุงูุจุฑุงุฒูู": ("ุจุฑุงุฒูููุง", "BR"),
    "ุจูุบุงุฑูุง": ("ุตูููุง", "BG"),
    "ููุฏุง": ("ุฃูุชุงูุง", "CA"),
    "ุงูุตูู": ("ุจููู", "CN"),
    "ูููููุจูุง": ("ุจูุบูุชุง", "CO"),
    "ูุฑูุงุชูุง": ("ุฒุบุฑุจ", "HR"),
    "ููุจุง": ("ูุงูุงูุง", "CU"),
    "ูุจุฑุต": ("ููููุณูุง", "CY"),
    "ุงูุชุดูู": ("ุจุฑุงุบ", "CZ"),
    "ุงูุฏููุงุฑู": ("ููุจููุงุบู", "DK"),
    "ูุตุฑ": ("ุงููุงูุฑุฉ", "EG"),
    "ุฅุซููุจูุง": ("ุฃุฏูุณ ุฃุจุงุจุง", "ET"),
    "ููููุฏุง": ("ููุณููู", "FI"),
    "ูุฑูุณุง": ("ุจุงุฑูุณ", "FR"),
    "ุฃููุงููุง": ("ุจุฑููู", "DE"),
    "ุงููููุงู": ("ุฃุซููุง", "GR"),
    "ุงูููุฏ": ("ูููุฏููู", "IN"),
    "ุฅูุฏูููุณูุง": ("ุฌุงูุฑุชุง", "ID"),
    "ุฅูุฑุงู": ("ุทูุฑุงู", "IR"),
    "ุงูุนุฑุงู": ("ุจุบุฏุงุฏ", "IQ"),
    "ุฅูุฑููุฏุง": ("ุฏุจูู", "IE"),
    "ุฅูุทุงููุง": ("ุฑููุง", "IT"),
    "ุงููุงุจุงู": ("ุทูููู", "JP"),
    "ุงูุฃุฑุฏู": ("ุนููุงู", "JO"),
    "ุงููููุช": ("ุงููููุช", "KW"),
    "ูุจูุงู": ("ุจูุฑูุช", "LB"),
    "ููุจูุง": ("ุทุฑุงุจูุณ", "LY"),
    "ูุงููุฒูุง": ("ููุงูุงููุจูุฑ", "MY"),
    "ุงููุบุฑุจ": ("ุงูุฑุจุงุท", "MA"),
    "ุงูููุณูู": ("ููุณููู ุณูุชู", "MX"),
    "ููููุฏุง": ("ุฃูุณุชุฑุฏุงู", "NL"),
    "ููุฌูุฑูุง": ("ุฃุจูุฌุง", "NG"),
    "ุงููุฑููุฌ": ("ุฃูุณูู", "NO"),
    "ุจุงูุณุชุงู": ("ุฅุณูุงู ุขุจุงุฏ", "PK"),
    "ููุณุทูู": ("ุงููุฏุณ", "PS"),
    "ุจูููุฏุง": ("ูุงุฑุณู", "PL"),
    "ุงูุจุฑุชุบุงู": ("ูุดุจููุฉ", "PT"),
    "ูุทุฑ": ("ุงูุฏูุญุฉ", "QA"),
    "ุฑููุงููุง": ("ุจูุฎุงุฑุณุช", "RO"),
    "ุฑูุณูุง": ("ููุณูู", "RU"),
    "ุงูุณุนูุฏูุฉ": ("ุงูุฑูุงุถ", "SA"),
    "ุงูุณูุบุงู": ("ุฏุงูุงุฑ", "SN"),
    "ุตุฑุจูุง": ("ุจูุบุฑุงุฏ", "RS"),
    "ุณูุบุงููุฑุฉ": ("ุณูุบุงููุฑุฉ", "SG"),
    "ุณูููุงููุง": ("ุจุฑุงุชูุณูุงูุง", "SK"),
    "ุฌููุจ ุฃูุฑูููุง": ("ุจุฑูุชูุฑูุง", "ZA"),
    "ููุฑูุง ุงูุฌููุจูุฉ": ("ุณููู", "KR"),
    "ุฅุณุจุงููุง": ("ูุฏุฑูุฏ", "ES"),
    "ุงูุณููุฏ": ("ุณุชูููููู", "SE"),
    "ุณููุณุฑุง": ("ุจุฑู", "CH"),
    "ุณูุฑูุง": ("ุฏูุดู", "SY"),
    "ุชููุณ": ("ุชููุณ", "TN"),
    "ุชุฑููุง": ("ุฃููุฑุฉ", "TR"),
    "ุฃููุฑุงููุง": ("ูููู", "UA"),
    "ุงูุฅูุงุฑุงุช": ("ุฃุจูุธุจู", "AE"),
    "ุงูููููุฉ ุงููุชุญุฏุฉ": ("ููุฏู", "GB"),
    "ุงูููุงูุงุช ุงููุชุญุฏุฉ": ("ูุงุดูุทู", "US"),
    "ููุฒูููุง": ("ูุงุฑุงูุงุณ", "VE"),
    "ููุชูุงู": ("ูุงููู", "VN"),
    "ุงูููู": ("ุตูุนุงุก", "YE")
    "ุขูุณููุฏุง": ("ุฑูููุงููู", "IS"),
    "ุฅุณุชูููุง": ("ุชุงููู", "EE"),
    "ุฅุฑูุชุฑูุง": ("ุฃุณูุฑุฉ", "ER"),
    "ุฃูุฒุจูุณุชุงู": ("ุทุดููุฏ", "UZ"),
    "ุงูุฃูุฑูุบูุงู": ("ูููุชููุฏูู", "UY"),
    "ุงูุฅููุงุฏูุฑ": ("ููุชู", "EC"),
    "ุจุงุฑุงุบูุงู": ("ุฃุณููุณููู", "PY"),
    "ุจุงูุงูุงุณ": ("ูุงุณู", "BS"),
    "ุจุงุฑุจุงุฏูุณ": ("ุจุฑูุฏุฌุชุงูู", "BB"),
    "ุจุฑููุงู": ("ุจูุฏุฑ ุณุฑู ุจูุงูุงู", "BN"),
    "ุจูููููุง": ("ุณููุฑู", "BO"),
    "ุจูุฑู": ("ูููุง", "PE"),
    "ุชุงููุงูุฏ": ("ุจุงูููู", "TH"),
    "ุชุงููุงู": ("ุชุงูุจูู", "TW"),
    "ุชุฑููุงูุณุชุงู": ("ุนุดู ุขุจุงุฏ", "TM"),
    "ุชุดุงุฏ": ("ูุฌุงูููุง", "TD"),
    "ุชูุฒุงููุง": ("ุฏูุฏููุง", "TZ"),
    "ุฌุงูุงููุง": ("ูููุบุณุชูู", "JM"),
    "ุฌุฒุฑ ุงูููุฑ": ("ููุฑููู", "KM"),
    "ุฌูุฑุฌูุง": ("ุชุจููุณู", "GE"),
    "ุฌูุจูุชู": ("ุฌูุจูุชู", "DJ"),
    "ุฑูุงูุฏุง": ("ููุบุงูู", "RW"),
    "ุฒุงูุจูุง": ("ููุณุงูุง", "ZM"),
    "ุฒููุจุงุจูู": ("ูุฑุงุฑู", "ZW"),
    "ุณุงุญู ุงูุนุงุฌ": ("ูุงููุณููุฑู", "CI"),
    "ุณุฑููุงููุง": ("ุณุฑู ุฌุงูุงูุงุฑุฏูุงุจูุฑุง ููุชู", "LK"),
    "ุณููููููุง": ("ูููุจููุงูุง", "SI"),
    "ุณูุฑููุงู": ("ุจุงุฑุงูุงุฑูุจู", "SR"),
    "ุณูุฑุงูููู": ("ูุฑูุชุงูู", "SL"),
    "ุณูุดู": ("ูููุชูุฑูุง", "SC"),
    "ุดููู": ("ุณุงูุชูุงุบู", "CL"),
    "ุบุงูุจูุง": ("ุจุงูุฌูู", "GM"),
    "ุบุงูุง": ("ุฃูุฑุง", "GH"),
    "ุบูุงุชููุงูุง": ("ุบูุงุชููุงูุง ุณูุชู", "GT"),
    "ุบูููุง": ("ูููุงูุฑู", "GN"),
    "ุบูููุง ุจูุณุงู": ("ุจูุณุงู", "GW"),
    "ุบูููุง ุงูุงุณุชูุงุฆูุฉ": ("ูุงูุงุจู", "GQ"),
    "ููุฌู": ("ุณููุง", "FJ"),
    "ููุฑุบูุฒุณุชุงู": ("ุจูุดููู", "KG"),
    "ูุงุฒุงุฎุณุชุงู": ("ุฃุณุชุงูุง", "KZ"),
    "ููุจูุฏูุง": ("ุจููู ุจูู", "KH"),
    "ููููุง": ("ููุฑูุจู", "KE"),
    "ูุงุชููุง": ("ุฑูุบุง", "LV"),
    "ููุชูุงููุง": ("ููููููุณ", "LT"),
    "ูููุณูุจูุฑุบ": ("ูููุณูุจูุฑุบ", "LU"),
    "ูุฏุบุดูุฑ": ("ุฃูุชุงูุงูุงุฑููู", "MG"),
    "ูุงูุทุง": ("ูุงููุชุง", "MT"),
    "ูุงูู": ("ุจุงูุงูู", "ML"),
    "ููุบูููุง": ("ุฃููุงู ุจุงุชูุฑ", "MN"),
    "ููุฒูุจูู": ("ูุงุจูุชู", "MZ"),
    "ูููุฏููุง": ("ููุดููุงู", "MD"),
    "ูุงููุจูุง": ("ูููุฏููู", "NA"),
    "ููุจุงู": ("ูุงุชูุงูุฏู", "NP"),
    "ูููุฒูููุฏุง": ("ูููููุบุชูู", "NZ"),
    "ูููุงุฑุงุบูุง": ("ูุงูุงุบูุง", "NI"),
    "ูุงูุชู": ("ุจูุฑุช ุฃู ุจุฑูุณ", "HT"),
    "ููุฏูุฑุงุณ": ("ุชูุบูุณูุบุงูุจุง", "HN"),
    "ููุบุงุฑูุง": ("ุจูุฏุงุจุณุช", "HU")


def flag_emoji(code):
    return "".join(chr(127397 + ord(c)) for c in code)

current_questions = {}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("๐ ูุนุจุฉ ุนูุงุตู ุงูุฏูู\nุงูุชุจ /play")

async def play(update: Update, context: ContextTypes.DEFAULT_TYPE):
    country = random.choice(list(countries.keys()))
    capital, code = countries[country]
    current_questions[update.effective_user.id] = capital
    await update.message.reply_text(
        f"๐ ูุง ูู ุนุงุตูุฉ {country}ุ {flag_emoji(code)}"
    )

async def check_answer(update: Update, context: ContextTypes.DEFAULT_TYPE):
    uid = update.effective_user.id
    if uid not in current_questions:
        return

    if update.message.text.strip() == current_questions[uid]:
        await update.message.reply_text("โ ุตุญูุญ")
    else:
        await update.message.reply_text(
            f"โ ุฎุทุฃุ ุงูุฅุฌุงุจุฉ: {current_questions[uid]}"
        )
    del current_questions[uid]

def main():
    app = ApplicationBuilder().token(os.environ["TOKEN"]).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("play", play))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, check_answer))
    app.run_polling()

if __name__ == "__main__":
    main()
